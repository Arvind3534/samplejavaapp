pipeline{
    agent{
       label 'java'
    }
    tools{
    maven 'maven-1'
    }
    environment{
    registry = "arvind3534/declarative-demo"
    registryCredential = 'docker-creds'
    dockerImage = ''
    }
    stages{
        stage('compile'){
            steps{
                sh "mvn clean compile"

            }
            
         }
        stage('unit-test'){
	        steps {
                echo 'unittest..'
	            sh  'mvn test'
             }
		  post {
               success {
                   junit 'target/surefire-reports/*.xml'
               }
           }
	   }
	   stage('package'){
            steps{
                sh "mvn clean package"

            }
            
         }
	 stage('Building image') {
      steps{
        sh 'cd $WORKSPACE'
        sh 'docker build -f Dockerfile -t arvind3534/declarative-demo:$BUILD_NUMBER .
      }
    }
        
     }
}

